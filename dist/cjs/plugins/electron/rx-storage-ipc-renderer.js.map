{"version":3,"file":"rx-storage-ipc-renderer.js","names":["_rxjs","require","_index","_electronHelper","_index2","getRxStorageIpcRenderer","settings","channelId","IPC_RENDERER_KEY_PREFIX","key","join","storage","getRxStorageRemote","identifier","statics","mode","messageChannelCreator","messages$","Subject","listener","_event","message","next","ipcRenderer","on","postMessage","Promise","resolve","send","msg","close","removeListener","PROMISE_RESOLVE_VOID"],"sources":["../../../../src/plugins/electron/rx-storage-ipc-renderer.ts"],"sourcesContent":["import { Subject } from 'rxjs';\nimport {\n    getRxStorageRemote,\n    RxStorageRemote,\n    RxStorageRemoteSettings,\n    MessageFromRemote\n} from '../storage-remote/index.ts';\nimport type {\n    RxStorageStatics\n} from '../../types/index.d.ts';\nimport {\n    IPC_RENDERER_KEY_PREFIX\n} from './electron-helper.ts';\nimport { PROMISE_RESOLVE_VOID } from '../utils/index.ts';\n\nexport type RxStorageIpcRendererSettings = {\n    /**\n     * Set the same key on both sides\n     * to ensure that messages do not get mixed\n     * up when you use more then one storage.\n     */\n    key: string;\n    statics: RxStorageStatics;\n    ipcRenderer: any;\n    mode: RxStorageRemoteSettings['mode'];\n};\n\nexport type RxStorageIpcRenderer = RxStorageRemote;\nexport function getRxStorageIpcRenderer(\n    settings: RxStorageIpcRendererSettings\n): RxStorageIpcRenderer {\n    const channelId = [\n        IPC_RENDERER_KEY_PREFIX,\n        settings.key\n    ].join('|');\n\n    const storage = getRxStorageRemote({\n        identifier: 'electron-ipc-renderer',\n        statics: settings.statics,\n        mode: settings.mode,\n        messageChannelCreator() {\n            const messages$ = new Subject<MessageFromRemote>();\n            const listener = (_event: any, message: any) => {\n                messages$.next(message);\n            };\n            settings.ipcRenderer.on(channelId, listener);\n            settings.ipcRenderer.postMessage(\n                channelId,\n                false\n            );\n            return Promise.resolve({\n                messages$,\n                send(msg) {\n                    settings.ipcRenderer.postMessage(\n                        channelId,\n                        msg\n                    );\n                },\n                close() {\n                    settings.ipcRenderer.removeListener(channelId, listener);\n                    return PROMISE_RESOLVE_VOID;\n                }\n            });\n        },\n    });\n    return storage;\n}\n"],"mappings":";;;;;;AAAA,IAAAA,KAAA,GAAAC,OAAA;AACA,IAAAC,MAAA,GAAAD,OAAA;AASA,IAAAE,eAAA,GAAAF,OAAA;AAGA,IAAAG,OAAA,GAAAH,OAAA;AAeO,SAASI,uBAAuBA,CACnCC,QAAsC,EAClB;EACpB,IAAMC,SAAS,GAAG,CACdC,uCAAuB,EACvBF,QAAQ,CAACG,GAAG,CACf,CAACC,IAAI,CAAC,GAAG,CAAC;EAEX,IAAMC,OAAO,GAAG,IAAAC,yBAAkB,EAAC;IAC/BC,UAAU,EAAE,uBAAuB;IACnCC,OAAO,EAAER,QAAQ,CAACQ,OAAO;IACzBC,IAAI,EAAET,QAAQ,CAACS,IAAI;IACnBC,qBAAqBA,CAAA,EAAG;MACpB,IAAMC,SAAS,GAAG,IAAIC,aAAO,CAAoB,CAAC;MAClD,IAAMC,QAAQ,GAAGA,CAACC,MAAW,EAAEC,OAAY,KAAK;QAC5CJ,SAAS,CAACK,IAAI,CAACD,OAAO,CAAC;MAC3B,CAAC;MACDf,QAAQ,CAACiB,WAAW,CAACC,EAAE,CAACjB,SAAS,EAAEY,QAAQ,CAAC;MAC5Cb,QAAQ,CAACiB,WAAW,CAACE,WAAW,CAC5BlB,SAAS,EACT,KACJ,CAAC;MACD,OAAOmB,OAAO,CAACC,OAAO,CAAC;QACnBV,SAAS;QACTW,IAAIA,CAACC,GAAG,EAAE;UACNvB,QAAQ,CAACiB,WAAW,CAACE,WAAW,CAC5BlB,SAAS,EACTsB,GACJ,CAAC;QACL,CAAC;QACDC,KAAKA,CAAA,EAAG;UACJxB,QAAQ,CAACiB,WAAW,CAACQ,cAAc,CAACxB,SAAS,EAAEY,QAAQ,CAAC;UACxD,OAAOa,4BAAoB;QAC/B;MACJ,CAAC,CAAC;IACN;EACJ,CAAC,CAAC;EACF,OAAOrB,OAAO;AAClB"}